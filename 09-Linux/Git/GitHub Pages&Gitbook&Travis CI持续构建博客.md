# GitHub Pages&Gitbook&Travis CIæŒç»­æ„å»ºåšå®¢

**æ¬¢è¿æ”¶è—äº¤æµ , å¦‚éœ€è½¬è½½ , è¯·æ³¨æ˜å‡ºå¤„**

## 1. å¼€å§‹  ğŸ€

å¦‚ä»Šç¨‹åºçŒ¿æ²¡ä¸ªä¸ªäººç«™ç‚¹æˆ–æ˜¯åšå®¢ , éƒ½ä¸å¥½æ„æ€å‡ºé—¨äº†

æ‰€ä»¥åœ¨è¿™é‡Œæ•™å¤§å®¶å¦‚ä½•æ„å»ºä¸€æœ¬ä¹¦ (åšå®¢) : https://lyonyang.github.io/blogs/ è¿™æ˜¯æˆ‘çš„ä¸ªäººåšå®¢ , æ ·å¼å°±æ˜¯è¿™æ ·çš„å•¦

é‚£ä¹ˆ , å¼€å§‹å§

### 1.1. æ­å»ºå‡†å¤‡  ğŸ€

å®é™…ä¸Š , æ²¡ä»€ä¹ˆè¦å‡†å¤‡çš„ ... GitHubè´¦å·å°±ä¸ç”¨è¯´äº† , åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“å§ , æ¥å­˜æ”¾ä¸ªäººåšå®¢ç¬”è®°æ–‡ä»¶

### 1.2. æ­å»ºè¦æ±‚  ğŸ€

æœ¬åšå®¢ (æ›´å½¢è±¡ç‚¹ : ä¸€æœ¬ä¹¦) , æ–‡ä»¶å¿…é¡»ä¸º`.md`æ–‡ä»¶ , ä¹Ÿå°±æ˜¯`MarkDown` æ–‡ä»¶ , æ‰€ä»¥å¦‚æœä½ ä¸æ˜¯è¿™ç§æ ¼å¼ , é‚£ä¹ˆæˆ‘å»ºè®®ä½ å¼€å§‹ä½¿ç”¨ , [Markdownè¯­æ³•è¯´æ˜](https://www.appinn.com/markdown/) , å½“ç„¶è¿˜æœ‰`.rst` , ä¹Ÿå°±æ˜¯`reStructuredText` æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ , ä½†æ˜¯æœ¬æ–‡ä»…è¯´æ˜å…³äºMarkdownçš„æ„å»º

**ä¸ºä»€ä¹ˆç”¨Markdown?**

1. Markdownæ˜¯ä¸€ç§è½»é‡çº§çš„ã€Œæ ‡è®°è¯­è¨€ã€ , é€šå¸¸ä¸ºç¨‹åºå‘˜ç¾¤ä½“æ‰€ç”¨ , é€‚ç”¨äºæ³¡æŠ€æœ¯è®ºå›ã€å†™åšå®¢æ—¥å¿—ã€æŠ€æœ¯æ–‡ç¨¿ã€è®°å½•ä»£ç ç‰‡æ®µã€èµ·è‰é‚®ä»¶ç­‰åœºæ™¯
2. Markdownè¯­æ³•ååˆ†ç®€å• , å¸¸ç”¨çš„æ ‡è®°ç¬¦å·ä¸è¶…è¿‡åä¸ª , ç”¨äºæ—¥å¸¸å†™ä½œè®°å½•ç»°ç»°æœ‰ä½™
3. çº¯æ–‡æœ¬ç¼–è¾‘ , å¯ä»¥è½¬æ¢æˆå„ç§æ–‡æ¡£æ ¼å¼ , å¦‚ : html , tex , pdç­‰ç­‰
4. æœ€é‡è¦çš„æ˜¯ , Markdownèƒ½åœ¨GitHubä¸Šç›´æ¥å±•ç¤ºå‡ºæ¥ , æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å¾ˆå¤šGitHubå¼€æºé¡¹ç›® (ä¸å¼€æºä½ ä¹Ÿçœ‹ä¸åˆ°å•Š) ä¸­çš„READMEéƒ½æ˜¯`.md`æ–‡ä»¶ 

æœ¬åœ°Markdownç¼–è¾‘å¯ä»¥ä½¿ç”¨Typora , VSCode , Atomç­‰ç­‰ , æœ¬äººç”¨çš„æ˜¯Typora , æ”¯æŒåŠŸèƒ½æ¯”è¾ƒå¤š

### 1.3. æ­å»ºè¯´æ˜  ğŸ€

æœ¬åšå®¢ä½¿ç”¨GitBookè¿›è¡Œæ„å»º , å¦‚Hexoä¸€æ · , æˆ‘ä»¬å¹¶ä¸æ˜¯ä½¿ç”¨GitBookæ‰€æœ‰ , è€Œæ˜¯ä»…ä»…ä½¿ç”¨å®ƒçš„ä¸€ä¸ªåŠŸèƒ½ : GitBookå’ŒHexoéƒ½èƒ½å¸®æˆ‘ä»¬æŠŠMarkdownæ ¼å¼æ–‡ä»¶è½¬æ¢æˆhtmlæ–‡ä»¶ , å¹¶ä¸”æ˜¯é™„å¸¦äº†æ ·å¼çš„htmlæ–‡ä»¶

å½“ç„¶è¿™ç§æ„å»ºå¯¹äºæˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸¤æ¬¡è¿˜å¥½ , å¦‚æœåƒæˆ‘ä»¬çš„åšå®¢éœ€è¦é•¿æœŸæ›´æ–° , é‚£ä¹ˆæ‰‹åŠ¨æ„å»ºå°±å¤ªéº»çƒ¦äº† , æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæŒç»­é›†æˆå·¥å…· Travis CI , å®ƒæ˜¯å¼€æºçš„ , æ‰€ä»¥æ”¾å¿ƒ , ä¸è¦é’±

ä¹Ÿå°±æ˜¯è¯´ ,  æ‰€æœ‰çš„å‡†å¤‡å¦‚ä¸‹ : 

- GitHub + .md + GitBook + Travis CI

é‚£ä¹ˆå°±å¼€å§‹äº†

## 2. é…ç½®æ–‡ä»¶   ğŸ€

åˆ›å»ºä»“åº“å°±ä¸è¯´äº† , åˆ›å»ºå®Œæˆä¹‹å , æˆ‘ä»¬å°±å…ˆå¼€å§‹æ·»åŠ é…ç½®æ–‡ä»¶äº† , è¿™æ˜¯æ„å»ºçš„é‡ä¸­ä¹‹é‡

é…ç½®æ–‡ä»¶ç›®å½•

```
.
â”œâ”€â”€ .travis.yml        -- æŒç»­é›†æˆé…ç½®
â”œâ”€â”€ deploy.sh          -- æ„å»ºè„šæœ¬
â”œâ”€â”€ book.json          -- gitbookæ ·å¼æ–‡ä»¶
â”œâ”€â”€ summary_create.sh  -- è‡ªåŠ¨åˆ›å»ºSUMMARY.mdæ–‡ä»¶
â”œâ”€â”€ SUMMARY.md         -- å¿…é¡»è¦æœ‰
â””â”€â”€ README.md   	   -- å¿…é¡»è¦æœ‰
```

### 2.1. .travis.yml  ğŸ€

å½“Travis CIå‘ç°ä½ çš„ä»“åº“æœ‰æ›´æ–°æ—¶ , å°±ä¼šæ¥ä½ ä»“åº“æ‰¾åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶ , å¹¶æ‰§è¡Œå®ƒ

ä»¥`node_js`è¯­è¨€ä¸ºä¾‹ 

```shell
language: "node_js"
node_js:
  - "node"
install:
  - "npm install -g gitbook@3.2.3"
  - "npm install -g gitbook-cli@2.3.2"
branches:
  only:
    - master
env:
  global:
    - GH_REF: github.com/ç”¨æˆ·å/ä»“åº“å.git
script:
  - bash summary_create.sh
  - travis_wait 100 bash deploy.sh
```

æ³¨æ„GH_REFä¿®æ”¹æˆå„è‡ªçš„GitHubç”¨æˆ·åå’Œä»“åº“

### 2.2. deploy.sh  ğŸ€

è¯¥æ–‡ä»¶æ˜¯`.travis.yml`ä¸­éœ€è¦æ‰§è¡Œçš„è„šæœ¬

```shell
#!/bin/bash
git config user.name "user"
git config user.email "email@xxx.com"
git checkout -b gitbook
git status
git add .
git commit -m "[Travis] Update SUMMARY.md"
git push -f "https://${GH_TOKEN}@${GH_REF}" gitbook:gitbook
gitbook install
gitbook build .
if [ $? -ne 0 ];then
    exit 1
fi
cd _book
git init
git checkout --orphan gh-pages
git status
sleep 5
git add .
git commit -m "Update gh-pages"
git remote add origin git@github.com:ç”¨æˆ·å/ä»“åº“.git
git push -f "https://${GH_TOKEN}@${GH_REF}" gh-pages:gh-pages
```

### 2.3. summary_create.sh  ğŸ€

```
#!/bin/bash

# æ–‡ä»¶å‘½åå¢åŠ  [0-9][0-9]- é€šè¿‡æ–‡ä»¶åå¯¹æ–‡ç« è¿›è¡Œæ’åº,ç”Ÿæˆç›®å½•

find `ls|egrep -v "_book|_other|node_modules"` -type f -name "*.md"|sed 's#README.md#00README.md#g'|sort|awk -F "/" '{if($NF!="00README.md") print $0"/" ;else print $0}' OFS="/"|sed  's#[^/]##g'|awk '{a=(length-1);while(a>0){printf "  ";a--}print "* "}' > /tmp/summary_1
find `ls|egrep -v "_book|_other|node_modules"` -type f -name "*.md"|sed "s#README.md#00README.md#g"|sort|awk -F "[./]" '{if($(NF-1) != "00README") print $(NF-1)"]("$0")" ;else print $(NF-2)"]("$0")"}' > /tmp/summary_2
paste -d "[" /tmp/summary_1 /tmp/summary_2 > tmp_SUMMARY.md
sed 's#00README.md#README.md#g' tmp_SUMMARY.md|grep -v "SUMMARY](SUMMARY"|awk  '{if(NR==1)print "# Summary\n\n* [Introduction](README.md)\n* [SUMMARY](SUMMARY.md)";else print $0}' > SUMMARY.md && mv tmp_SUMMARY.md /tmp

# ç”±äºMacä¸‹,sed -iå‚æ•°å¿…é¡»è¦æŒ‡å®šå¤‡ä»½æ–‡ä»¶(è™½ç„¶å¯ä»¥ä½¿ç”¨ -i "" ä¼ é€’ä¸€ä¸ªç©ºå­—ç¬¦,ä¸å¤‡ä»½,ä½†æ˜¯è¿™ç§å†™æ³•åœ¨Linuxä¸Šä¼šæŠ¥é”™),æ‰€ä»¥è¿™é‡Œä¸ä½¿ç”¨-iå‚æ•°

# æ–‡ä»¶åä¾¿äºæ’åºçš„æ—¶å€™ä¼šä½¿ç”¨ç±»ä¼¼01-,å¼€å¤´, åœ¨ç›®å½•æ˜¾ç¤ºçš„æ—¶å€™åˆ é™¤è¿™éƒ¨åˆ† 

# è°ƒæ•´ç›®å½•æ˜¾ç¤º, åœ¨Mac ä¸‹ä½¿ç”¨éœ€è¦è°ƒæ•´å‚æ•°

sed -ri 's#(\S+* \[)[0-9]+-(.*$)#\1\2#g' SUMMARY.md
```

### 2.4. book.json  ğŸ€

GitBookæ ·å¼æ–‡ä»¶ , ä¹Ÿå°±æ˜¯ç”Ÿæˆhtmlé™„å¸¦çš„æ ·å¼

```
{
    "title": "blog",
    "author": "author",
    "description": "desc",
    "extension": null,
    "generator": "site",
    "links": {
        "sharing": {
            "all": null,
            "facebook": null,
            "google": null,
            "twitter": null,
            "weibo": null
        }
    },
    "pdf": {
        "fontSize": 18,
        "footerTemplate": null,
        "headerTemplate": null,
        "margin": {
            "bottom": 36,
            "left": 62,
            "right": 62,
            "top": 36
        },
        "pageNumbers": false,
        "paperSize": "a4"
    },
    "plugins": [
        "advanced-emoji",
        "toggle-chapters",
        "theme-comscore",
        "splitter",
        "github",
        "-sharing",
        "-lunr",
        "-search",
        "search-plus",
        "anchor-navigation-ex@1.0.10",
        "editlink"
    ],
    "pluginsConfig": {
        "anchor-navigation-ex": {
            "showLevel": false,
            "mode": "float",
            "float": {
                "showLevelIcon": false,
                "level1Icon": "fa fa-hand-o-right",
                "level2Icon": "fa fa-hand-o-right",
                "level3Icon": "fa fa-hand-o-right"
            }
        }
    }
}
```

### 2.5. README.md  ğŸ€

é¡¹ç›®æ ¹ç›®å½•ä¸‹å¿…é¡»è¦æœ‰README.mdæ–‡ä»¶ , å¹¶ä¸”æ‰€æœ‰éœ€è¦æ„å»ºçš„æ–‡ä»¶ä¸‹ , ä¹Ÿå¿…é¡»è¦æœ‰README.mdæ–‡ä»¶

å¦‚ : 

```
.
â”œâ”€â”€ Python
â”‚   â”œâ”€â”€ ...
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ README.md      -- å¿…é¡»è¦æœ‰
â”œâ”€â”€ ...
â”œâ”€â”€ ...
â””â”€â”€ README.md   	   -- å¿…é¡»è¦æœ‰
```

README.mdä¸­çš„å†…å®¹å°±æ˜¯é¡µé¢ä¸Šç›®å½•æ˜¾ç¤ºçš„å†…å®¹

### 2.6. SUMMARY.md  ğŸ€

å¿…é¡»è¦æœ‰ , è¿™ä¸ªGitBookæ„å»ºéœ€è¦çš„ , ä¸Šé¢summary_create.shè„šæœ¬å°±æ˜¯æ¥è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆç›®å½•çš„

## 3. æ·»åŠ Personal access tokens  ğŸ€

é…ç½®æ–‡ä»¶æ·»åŠ å®Œæˆä¹‹å , æˆ‘ä»¬å°±è¦å°†Travis CI ä¸GitHubå»ºç«‹è¿æ¥äº†

```
ç‚¹å‡»ä½ çš„GitHubå¤´åƒ --> Settings --> Developer settings --> Personal access tokens --> Generate new token
```

è¿›å…¥å¦‚ä¸‹å›¾é¡µé¢ : 

![New personal access token](https://github.com/lyonyang/blogs/blob/master/assets/New%20personal%20access%20token.png?raw=true)

æˆ‘ä»¬åªéœ€ç»™ä¸ªrepoæƒé™å°±è¡Œäº†

æ¥ä¸‹æ¥å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°å¦‚ä¸‹é¡µé¢ : 

![Copy Token](https://github.com/lyonyang/blogs/blob/master/assets/Copy%20Token.png?raw=true)

æ³¨æ„ : ä¸€å®šè¦å…ˆå¤åˆ¶è¿™ä¸ªç”Ÿæˆçš„token , å¦‚æœä½ è¿˜æ²¡æ¥å¾—åŠå¤åˆ¶ , é‚£ä¹ˆå¯¹ä¸èµ· , é‡æ–°æ·»åŠ ä¸€ä¸ªå†å¤åˆ¶å§

è¿™ä¸ªtokenæ˜¯ç”¨æ¥é…ç½®Travisçš„ç¯å¢ƒå˜é‡çš„

## 4. é…ç½®Travis CI  ğŸ€

é¦–å…ˆæˆ‘ä»¬è¿›å…¥ : [https://travis-ci.org/](https://travis-ci.org/) 

ä½¿ç”¨GitHubç™»å½•

æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åœ¨Profileä¸‹é¢çœ‹åˆ°æˆ‘ä»¬çš„GitHubä»“åº“å•¦ , æ³¨æ„[https://travis-ci.org/](https://travis-ci.org/) æœç´¢çš„æˆ‘ä»¬çš„Publicä»“åº“ , å¯¹äºPrivateä»“åº“ , å°±éœ€è¦è¿›å…¥[https://travis-ci.com/](https://travis-ci.com/) 

å‹¾é€‰éœ€è¦æŒç»­é›†æˆçš„ä»“åº“

![choose repositories](https://github.com/lyonyang/blogs/blob/master/assets/choose%20repositories.png?raw=true)

æ¥ä¸‹æ¥æˆ‘ä»¬å»åšä¸€äº›è®¾ç½®äº† , ç‚¹å‡»å‹¾é€‰å³è¾¹çš„è®¾ç½®æŒ‰é’®

å‹¾é€‰Generalä¸­çš„`Build only if .travis.yml is present`

**Environment Variables**

ç°åœ¨æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸Šé¢ç”Ÿæˆçš„tokenäº† , å°†å…¶å¤åˆ¶åˆ°Environment Variablesä¸­çš„Valueæ¡†ä¸­ , å¹¶å°†Nameè®¾ç½®ä¸º`GH_TOKEN` , ç‚¹å‡»ADDæ·»åŠ  , å®Œæˆåå¦‚ä¸‹ : 

![add token](https://github.com/lyonyang/blogs/blob/master/assets/add%20token.png?raw=true)

ç°åœ¨åŸºæœ¬å·²ç»å®Œæˆäº† , æˆ‘ä»¬å¯ä»¥å‘æˆ‘ä»¬çš„ä»“åº“åšä¸€ç‚¹æ›´æ–° , æˆ–è€…ç›´æ¥ç‚¹å‡»`More options`é€‰æ‹©Trigger buildè¿›è¡Œæ„å»º , ç­‰å¾…å‡ åˆ†é’Ÿå (è¿™æ˜¯GitBookçš„ä¸€ä¸ªç¼ºç‚¹ , æ„å»ºæœ‰ç‚¹æ…¢)

å¾…`https://travis-ci.org/`å·¦ä¾§ `My Repositories` å˜æˆç»¿è‰² (é»„è‰²è¡¨ç¤ºæ­£åœ¨æ„å»º) , æˆ‘ä»¬å°±å¯ä»¥è®¿é—®æˆ‘ä»¬çš„åšå®¢å•¦ 

åœ°å€ : `https://ç”¨æˆ·å.github.io/ä»“åº“å` 

è¿™ä¸ªåœ°å€ä½¿ç”¨çš„æ˜¯æ¯ä¸ªä»“åº“è‡ªå¸¦çš„GitHub PagesåŠŸèƒ½ , åœ¨è„šæœ¬è‡ªåŠ¨åˆ›å»ºäº†gh-pagesåˆ†æ”¯ , å°±æ˜¯ç”¨äºæ˜¾ç¤ºçš„

è‡³æ­¤ , æ­å»ºå®Œæˆ !

## 5. æ³¨æ„äº‹é¡¹

**æ³¨æ„äº‹é¡¹ä¸€**

ç”±äºæ„å»ºæ˜¯ä»`.md`æ–‡ä»¶è½¬åˆ°`.html`æ–‡ä»¶ , æ‰€ä»¥å¦‚æœæ–‡ç« ä¸­ä½¿ç”¨äº†æ¨¡æ¿è¯­è¨€çš„è¯­æ³• , è¯·åµŒå…¥htmlä»£ç å— , å¹¶é¡¶æ ¼å†™ , ç¤ºä¾‹

```html
â€‹```html
å†…å®¹{{ name }}
```

**æ³¨æ„äº‹é¡¹äºŒ**

æ–‡ç« æ’åºé»˜è®¤æŒ‰è‹±æ–‡å­—æ¯æ’åº , å¦‚æœéœ€è¦å¯¹æ–‡ç« è¿›è¡Œæ’åº , å¯ä»¥åœ¨æ–‡ä»¶åå‰æ·»åŠ éœ€è¦ , å¦‚ : `01-`  , åºå·ä¸ä¼šåœ¨æ–‡ç« é¡µé¢æ˜¾ç¤º , è¿™ä¸€æ­¥æ˜¯é€šè¿‡summary_create.shä¸­å®ç°çš„

**æ³¨æ„äº‹é¡¹ä¸‰**

æ–‡ä»¶å¤¹åç§°ä¸­ä¸å¾—åŒ…å«ç©ºæ ¼

**ä½ å¯èƒ½éœ€è¦çš„ä¸€äº›gitbookæ’ä»¶:[æ’ä»¶](https://gitbook.zhangjikai.com/plugins.html)**
