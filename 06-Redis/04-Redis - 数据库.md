# Redis - æ•°æ®åº“


<extoc></extoc>

## ä»‹ç»  ğŸ€

Redis æœåŠ¡å™¨é»˜è®¤ä¼šåˆ›å»º 16 ä¸ªæ•°æ®åº“ , è¯¥å€¼ç”±æœåŠ¡å™¨é…ç½®çš„ `databases` é€‰é¡¹å†³å®š , é»˜è®¤ä¸º16 , æŸ¥çœ‹æ–¹å¼å¦‚ä¸‹ : 

```shell
127.0.0.1:6379> config get databases
1) "databases"
2) "16"
```

åˆ‡æ¢æ•°æ®åº“

```shell
127.0.0.1:6379> SELECT 1
OK
127.0.0.1:6379[1]> SELECT 0
OK
127.0.0.1:6379> 
```

## ç”Ÿå­˜æ—¶é—´  ğŸ€

é€šè¿‡ `EXPIRE` å‘½ä»¤æˆ–è€… `PEXPIRE` å‘½ä»¤ , å®¢æˆ·ç«¯å¯ä»¥ä»¥ç§’æˆ–è€…æ¯«ç§’ç²¾åº¦ä¸ºæ•°æ®åº“ä¸­çš„æŸä¸ªé”®è®¾ç½®ç”Ÿå­˜æ—¶é—´ (Time To Live , TTL) , åœ¨ç»è¿‡æŒ‡å®šçš„ç§’æ•°æˆ–è€…æ¯«ç§’æ•°ä¹‹å , æœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨åˆ é™¤ç”Ÿå­˜æ—¶é—´ä¸º 0 çš„é”®

å®ä¾‹

```shell
127.0.0.1:6379> SET key value
OK
127.0.0.1:6379> EXPIRE key 5
(integer) 1
127.0.0.1:6379> GET key  # 5ç§’ä¹‹å†…
"value"
127.0.0.1:6379> GET key  # 5ç§’ä¹‹å
(nil)
```

## è¿‡æœŸæ—¶é—´  ğŸ€

ä¸ `EXPIRE` å‘½ä»¤å’Œ `REXPIRE` å‘½ä»¤ç±»ä¼¼ , å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ `EXPIREAT` å‘½ä»¤æˆ– `PEXPIREAT` å‘½ä»¤ , ä»¥ç§’æˆ–è€…æ¯«ç§’ç²¾åº¦ç»™æ•°æ®åº“ä¸­çš„æŸä¸ªé”®è®¾ç½®è¿‡æœŸæ—¶é—´ (Expire Time)

è¿‡æœŸæ—¶é—´æ˜¯ UNIX æ—¶é—´æˆ³ , å½“é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ , æœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨ä»æ•°æ®åº“ä¸­åˆ é™¤è¿™ä¸ªé”®

å®ä¾‹

```shell
127.0.0.1:6379> SET key value
OK
127.0.0.1:6379> EXPIREAT key 1377257300
(integer) 1
127.0.0.1:6379> Time
1) "1377257296"
2) "296543"
127.0.0.1:6379> GET key  # 1377257300ä¹‹å‰
"value"
127.0.0.1:6379> Time
1) "1529772303"
2) "230656"
127.0.0.1:6379> GET key  # 1377257300ä¹‹å
(nil)
```

TTL å‘½ä»¤å’Œ PTTL å‘½ä»¤æ¥å—ä¸€ä¸ªå¸¦æœ‰ç”Ÿå­˜æ—¶é—´æˆ–è€…è¿‡æœŸæ—¶é—´çš„é”® , è¿”å›è¿™ä¸ªé”®çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ , ä¹Ÿå°±æ˜¯ , è¿”å›è·ç¦»è¿™ä¸ªé”®è¢«æœåŠ¡å™¨è‡ªåŠ¨åˆ é™¤è¿˜æœ‰å¤šé•¿æ—¶é—´

å®ä¾‹

```shell
127.0.0.1:6379> SET key value
OK
127.0.0.1:6379> EXPIRE key 1000
(integer) 1
127.0.0.1:6379> TTL key
(integer) 997
127.0.0.1:6379> PTTL key
(integer) 93633
```

æˆ‘ä»¬å¯ä»¥å‘ç° Redis æœ‰å››ä¸ªä¸åŒçš„å‘½ä»¤å¯ä»¥ç”¨äºè®¾ç½®é”®çš„ç”Ÿå­˜æ—¶é—´æˆ–è¿‡æœŸæ—¶é—´ : 

```shell
EXPIRE <key> <ttl> # å‘½ä»¤ç”¨äºå°†é”®keyçš„ç”Ÿå­˜æ—¶é—´è®¾ç½®ä¸ºttlç§’
PEXPIRE <key> <ttl> # å‘½ä»¤ç”¨äºå°†é”®keyçš„ç”Ÿå­˜æ—¶é—´è®¾ç½®ä¸ºttlæ¯«ç§’
EXPIREAT <key> <timestamp> # å‘½ä»¤ç”¨äºå°†é”®keyçš„ç”Ÿå­˜æ—¶é—´è®¾ç½®ä¸ºtimestampæ¯«ç§’
PEXPIREAT <key> <timestamp> # å‘½ä»¤ç”¨äºå°†é”®keyçš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºtimestampæ¯«ç§’
```

è™½ç„¶æœ‰å¤šç§ä¸åŒå•ä½å’Œä¸åŒå½¢å¼çš„è®¾ç½®å‘½ä»¤ , ä½†æ˜¯å®é™…ä¸Š EXPIRE , PEXPIRE , EXPIREAT ä¸‰ä¸ªå‘½ä»¤éƒ½æ˜¯ä½¿ç”¨ PEXPIREAT å‘½ä»¤æ¥å®ç°çš„ : æ— è®ºå®¢æˆ·ç«¯æ‰§è¡Œçš„æ˜¯ä»¥ä¸Šå››ä¸ªå‘½ä»¤ä¸­çš„å“ªä¸€ä¸ª , ç»è¿‡è½¬æ¢ä¹‹å , æœ€ç»ˆæ‰§è¡Œçš„æ•ˆæœéƒ½å’Œæ‰§è¡Œ PEXPIREAT å‘½ä»¤ä¸€æ ·

**ä¿å­˜è¿‡æœŸæ—¶é—´**

å½“å®¢æˆ·ç«¯æ‰§è¡Œ PEXPIREAT å‘½ä»¤ (æˆ–è€…å…¶ä»–ä¸‰ä¸ªå‘½ä»¤) ä¸ºä¸€ä¸ªæ•°æ®åº“é”®è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ , æœåŠ¡å™¨ä¼šåœ¨æ•°æ®åº“çš„è¿‡æœŸå­—å…¸ä¸­å…³è”ç»™å®šçš„æ•°æ®åº“é”®å’Œè¿‡æœŸæ—¶é—´

**ç§»é™¤è¿‡æœŸæ—¶é—´**

`PERSIST` å‘½ä»¤æ˜¯ `PEXPIREAT` å‘½ä»¤çš„åæ“ä½œ : `PERSIST` å‘½ä»¤åœ¨è¿‡æœŸå­—å…¸ä¸­æŸ¥æ‰¾ç»™å®šçš„é”® , å¹¶è§£é™¤å’Œå€¼ (è¿‡æœŸæ—¶é—´) åœ¨è¿‡æœŸå­—å…¸ä¸­çš„å…³è”

Redis è¿‡æœŸé”®åˆ é™¤ç­–ç•¥ : é€šè¿‡é…åˆä½¿ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ä¸¤ç§ç­–ç•¥ , æœåŠ¡å™¨å¯ä»¥å¾ˆå¥½åœ°åœ¨åˆç†ä½¿ç”¨ CPU æ—¶é—´å’Œé¿å…æµªè´¹å†…å­˜ç©ºé—´ä¹‹é—´å–å¾—å¹³è¡¡

## æŒä¹…åŒ–  ğŸ€

Redis æ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“æœåŠ¡å™¨ , æœåŠ¡å™¨ä¸­é€šå¸¸åŒ…å«ç€ä»»æ„ä¸ªéç©ºæ•°æ®åº“ , è€Œæ¯ä¸ªéç©ºæ•°æ®åº“ä¸­åˆå¯ä»¥åŒ…å«ä»»æ„ä¸ªé”®å€¼å¯¹ , ä¸ºäº†æ–¹ä¾¿èµ·è§ , æˆ‘ä»¬å°†æœåŠ¡å™¨ä¸­çš„éç©ºæ•°æ®åº“ä»¥åŠä»–ä»¬çš„é”®å€¼å¯¹ç»Ÿç§°ä¸ºæ•°æ®åº“çŠ¶æ€

å› ä¸º Redis æ˜¯å†…å­˜æ•°æ®åº“ , å®ƒå°†è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€å‚¨å­˜åœ¨å†…å­˜é‡Œé¢ , æ‰€ä»¥å¦‚æœä¸æƒ³åŠæ³•å°†å‚¨å­˜åœ¨å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜é‡Œé¢ , é‚£ä¹ˆä¸€æ—¦æœåŠ¡å™¨è¿›ç¨‹é€€å‡º , æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¹Ÿä¼šæ¶ˆå¤±ä¸è§ , å› æ­¤ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ , Redis æä¾›äº†æŒä¹…åŒ–åŠŸèƒ½

### RDBæŒä¹…åŒ–  ğŸ€

RDB æŒä¹…åŒ–åŠŸèƒ½å¯ä»¥å°† Redis åœ¨å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜é‡Œé¢ , é¿å…æ•°æ®æ„å¤–ä¸¢å¤±

RDB æŒä¹…åŒ–æ—¢å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ , ä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å™¨é…ç½®é€‰é¡¹å®šæœŸæ‰§è¡Œ , è¯¥åŠŸèƒ½å¯ä»¥å°†æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ª RDB æ–‡ä»¶ä¸­

RDB æŒä¹…åŒ–åŠŸèƒ½æ‰€ç”Ÿæˆçš„ RDB æ–‡ä»¶æ˜¯ä¸€ä¸ªç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ , é€šè¿‡è¯¥æ–‡ä»¶å¯ä»¥è¿˜åŸç”Ÿæˆ RDB æ–‡ä»¶æ—¶çš„æ•°æ®åº“çŠ¶æ€

**RDB æ–‡ä»¶çš„åˆ›å»ºå’Œè½½å…¥**

æœ‰ä¸¤ä¸ªå‘½ä»¤å¯ä»¥ç”¨äºç”Ÿæˆ RDB æ–‡ä»¶ :

1. SAVE , ä¼šé˜»å¡ Redis æœåŠ¡å™¨è¿›ç¨‹ , çŸ¥é“ RDB æ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ , åœ¨æœåŠ¡å™¨è¿›ç¨‹é˜»å¡æœŸé—´ , æœåŠ¡å™¨ä¸èƒ½å¤„ç†ä»»ä½•è¯·æ±‚

   ```shell
   redis> SAVE
   OK
   ```

2. BGSAVE , ä¼šæ´¾ç”Ÿå‡ºä¸€ä¸ªå­è¿›ç¨‹ , ç„¶åç”±å­è¿›ç¨‹è´Ÿè´£åˆ›å»º RDB æ–‡ä»¶ , æœåŠ¡å™¨è¿›ç¨‹ (çˆ¶è¿›ç¨‹) ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚

   ```shell
   redis> BGSAVE
   Background saving started
   ```

å’Œä½¿ç”¨ SAVE å‘½ä»¤æˆ–è€… BGSAVE å‘½ä»¤åˆ›å»º RDB æ–‡ä»¶ä¸åŒ , RDB æ–‡ä»¶çš„è½½å…¥å·¥ä½œæ˜¯åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„ , æ‰€ä»¥ Redis å¹¶æ²¡æœ‰ä¸“é—¨ç”¨äºè½½å…¥ RDB æ–‡ä»¶çš„å‘½ä»¤ , åªè¦ Redis æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶æ£€æµ‹åˆ° RDB æ–‡ä»¶å­˜åœ¨ , å°±ä¼šè‡ªåŠ¨è½½å…¥ RDB æ–‡ä»¶

å¹¶ä¸”æœåŠ¡å™¨åœ¨è½½å…¥ RDB æ–‡ä»¶æœŸé—´ , ä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ , ç›´åˆ°è½½å…¥å·¥ä½œå®Œæˆä¸ºæ­¢

æ³¨æ„ : åœ¨è½½å…¥æˆ–ç”Ÿæˆ RDB æ–‡ä»¶æ—¶ , åªä¼šè½½å…¥æœªè¿‡æœŸçš„é”® , è€Œè¿‡æœŸçš„é”®ä¼šè¢«ç›´æ¥å¿½ç•¥

### AOFæŒä¹…åŒ–  ğŸ€

é™¤äº† RDB æŒä¹…åŒ–åŠŸèƒ½ä¹‹å¤– , Redis è¿˜æä¾›äº† AOF (Append Only File) æŒä¹…åŒ–åŠŸèƒ½ , ä¸ RDB æŒä¹…åŒ–é€šè¿‡ä¿å­˜æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹æ¥è®°å½•æ•°æ®åº“çŠ¶æ€ä¸åŒ , AOF æŒä¹…åŒ–æ˜¯é€šè¿‡ä¿å­˜ Redis æœåŠ¡å™¨æ‰€æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„

AOF æŒä¹…åŒ–åŠŸèƒ½çš„å®ç°å¯ä»¥åˆ†ä¸ºå‘½ä»¤è¿½åŠ  (Append) , æ–‡ä»¶å†™å…¥ , æ–‡ä»¶åŒæ­¥ (Sync) ä¸‰ä¸ªæ­¥éª¤

**AOF æ–‡ä»¶è½½å…¥ä¸æ•°æ®è¿˜åŸ**

å› ä¸º AOF æ–‡ä»¶é‡Œé¢åŒ…å«äº†é‡å»ºæ•°æ®åº“çŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰å†™å‘½ä»¤ , æ‰€ä»¥æœåŠ¡å™¨åªè¦è¯»å…¥å¹¶é‡æ–°æ‰§è¡Œä¸€é AOF æ–‡ä»¶é‡Œé¢ä¿å­˜çš„å†™å‘½ä»¤ , å°±å¯ä»¥è¿˜åŸæœåŠ¡å™¨å…³é—­ä¹‹å‰çš„æ•°æ®åº“çŠ¶æ€

Redis è¯»å– AOF æ–‡ä»¶å¹¶è¿˜åŸæ•°æ®åº“çŠ¶æ€çš„è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ : 

1. åˆ›å»ºä¸€ä¸ªä¸å¸¦ç½‘ç»œè¿æ¥çš„ä¼ªå®¢æˆ·ç«¯ (fake client) : å› ä¸º Redis çš„å‘½ä»¤åªèƒ½åœ¨å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ , è€Œè½½å…¥ AOF æ–‡ä»¶æ—¶æ‰€ä½¿ç”¨çš„å‘½ä»¤ç›´æ¥æ¥æºäº AOF æ–‡ä»¶è€Œä¸æ˜¯ç½‘ç»œè¿æ¥ , æ‰€ä»¥æœåŠ¡å™¨ä½¿ç”¨äº†ä¸€ä¸ªæ²¡æœ‰ç½‘ç»œè¿æ¥çš„ä¼ªå®¢æˆ·ç«¯æ¥æ‰§è¡Œ AOF æ–‡ä»¶ä¿å­˜çš„å†™å‘½ä»¤ , ä¼ªå®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤çš„æ•ˆæœå’Œå¸¦ç½‘ç»œè¿æ¥çš„å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤çš„æ•ˆæœå®Œå…¨ä¸€æ ·
2. ä» AOF æ–‡ä»¶ä¸­åˆ†æå¹¶è¯»å–å‡ºä¸€æ¡å†™å‘½ä»¤
3. ä½¿ç”¨ä¼ªå®¢æˆ·ç«¯æ‰§è¡Œè¢«è¯»å‡ºçš„å‘½ä»¤
4. ä¸€ç›´æ‰§è¡Œæ­¥éª¤ 2 å’Œæ­¥éª¤ 3 , çŸ¥é“ AOF æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†™å‘½ä»¤éƒ½è¢«å¤„ç†å®Œæ¯•ä¸ºæ­¢ 

**AOF é‡å†™**

ç”±äºéšç€æœåŠ¡å™¨è¿è¡Œæ—¶é—´çš„æµé€ , AOF æ–‡ä»¶ä¸­çš„å†…å®¹ä¼šè¶Šæ¥è¶Šå¤š , æ–‡ä»¶çš„ä½“ç§¯ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ , ä¸ºäº†è§£å†³è¿™ AOF æ–‡ä»¶ä½“ç§¯è†¨èƒ€çš„é—®é¢˜ , Redis æä¾›äº† AOF æ–‡ä»¶é‡å†™ (rewrite) åŠŸèƒ½ , é€šè¿‡è¯¥åŠŸèƒ½ , Redis æœåŠ¡å™¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶æ¥æ›¿ä»£ç°æœ‰çš„ AOF æ–‡ä»¶

å’Œç”Ÿæˆ RDB æ–‡ä»¶æ—¶ç±»ä¼¼ , åœ¨æ‰§è¡Œ AOF é‡å†™çš„è¿‡ç¨‹ä¸­ , ç¨‹åºä¼šå¯¹æ•°æ®åº“ä¸­çš„é”®è¿›è¡Œæ£€æŸ¥ , å·²è¿‡æœŸçš„é”®ä¸ä¼šè¢«ä¿å­˜åˆ°é‡å†™åçš„ AOF æ–‡ä»¶ä¸­

ç”±äº Redis æ˜¯å•çº¿ç¨‹çš„ , é‚£ä¹ˆåœ¨é‡å†™ AOF æ–‡ä»¶æœŸé—´ , æœåŠ¡å™¨å°†æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤è¯·æ±‚ , æ‰€ä»¥ Redis å†³å®šå°† AOF é‡å†™ç¨‹åºæ”¾åˆ°å­è¿›ç¨‹é‡Œæ‰§è¡Œ , ä»¥è¾¾åˆ°å¦‚ä¸‹ç›®çš„ :

- å­è¿›ç¨‹è¿›è¡Œ AOF é‡å†™æœŸé—´ , æœåŠ¡å™¨è¿›ç¨‹ (çˆ¶è¿›ç¨‹) å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚
- å­è¿›ç¨‹å¸¦æœ‰æœåŠ¡å™¨è¿›ç¨‹çš„æ•°æ®å‰¯æœ¬ , ä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹ , å¯ä»¥åœ¨é¿å…ä½¿ç”¨é”çš„æƒ…å†µä¸‹ , ä¿è¯æ•°æ®çš„å®‰å…¨æ€§

ä½†æ˜¯ç”±äºå­è¿›ç¨‹è¿›è¡Œ AOF é‡å†™æœŸé—´ , æœåŠ¡å™¨è¿›ç¨‹è¿˜éœ€è¦ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ , è€Œæ–°çš„å‘½ä»¤å¯èƒ½ä¼šå¯¹ç°æœ‰çš„æ•°æ®åº“çŠ¶æ€è¿›ç¨‹ä¿®æ”¹ , ä»è€Œä½¿å¾—æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€å’Œé‡å†™åçš„ AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ ; ä¸ºæ­¤ , Redis æœåŠ¡å™¨è®¾ç½®äº†ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒº , è¿™ä¸ªç¼“å†²åŒºåœ¨æœåŠ¡å™¨åˆ›å»ºå­è¿›ç¨‹ä¹‹åå¼€å§‹ä½¿ç”¨ , å½“ Redis æœåŠ¡å™¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹å , å®ƒä¼šåŒæ—¶å°†è¿™ä¸ªå†™å‘½ä»¤å‘é€ç»™ AOF ç¼“å†²åŒºå’Œ AOF é‡å†™ç¼“å†²åŒº

ä¹Ÿå°±æ˜¯è¯´ AOF é‡å†™æœŸé—´ , æœåŠ¡å™¨è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œ : 

1. æ‰§è¡Œå®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤
2. å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° AOF ç¼“å†²åŒº
3. å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° AOF é‡å†™ç¼“å†²åŒº

å½“å­è¿›ç¨‹å®Œæˆ AOF é‡å†™å·¥ä½œå , å®ƒä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å· , ä¼šè°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•° , å¹¶æ‰§è¡Œä»¥ä¸‹å·¥ä½œ : 

1. å°† AOF é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ , è¿™æ—¶æ–° AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€å°†å’ŒæœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´
2. å¯¹æ–°çš„ AOF æ–‡ä»¶è¿›è¡Œæ”¹å , åŸå­åœ°è¦†ç›–ç°æœ‰çš„ AOF æ–‡ä»¶ , å®Œæˆæ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶çš„æ›¿æ¢

æ³¨æ„ : é»˜è®¤å¦‚æœ AOF æŒä¹…åŒ–åŠŸèƒ½å¼€å¯ , é‚£ä¹ˆå°†ä¼˜å…ˆä½¿ç”¨ AOF 

## å‘å¸ƒè®¢é˜…   ğŸ€

Redis å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ : å‘é€è€…(pub)å‘é€æ¶ˆæ¯ , è®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯

Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“

ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ `channel1` ,  ä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ : `client2` , `client5` å’Œ `client1` ä¹‹é—´çš„å…³ç³» :  

![pubsub1](http://oux34p43l.bkt.clouddn.com/pubsub1.png)

å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ `PUBLISH` å‘½ä»¤å‘é€ç»™é¢‘é“ `channel1` æ—¶ , è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ :

![pubsub2](http://oux34p43l.bkt.clouddn.com/pubsub2.png)

**å®ä¾‹**

ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†å‘å¸ƒè®¢é˜…æ˜¯å¦‚ä½•å·¥ä½œçš„ , åœ¨æˆ‘ä»¬å®ä¾‹ä¸­æˆ‘ä»¬åˆ›å»ºäº†è®¢é˜…é¢‘é“åä¸ºÂ `redisChat` : 

```shell
redis 127.0.0.1:6379> SUBSCRIBE redisChat
 
Reading messages... (press Ctrl-C to quit)
1) "subscribe"
2) "redisChat"
3) (integer) 1
```

ç°åœ¨ , æˆ‘ä»¬å…ˆé‡æ–°å¼€å¯ä¸ª redis å®¢æˆ·ç«¯ , ç„¶ååœ¨åŒä¸€ä¸ªé¢‘é“ redisChat å‘å¸ƒä¸¤æ¬¡æ¶ˆæ¯ , è®¢é˜…è€…å°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯

```shell
redis 127.0.0.1:6379> PUBLISH redisChat "Redis is a great caching technique"
 
(integer) 1
 
redis 127.0.0.1:6379> PUBLISH redisChat "Learn redis by w3cschool.cc"
 
(integer) 1
 
# è®¢é˜…è€…çš„å®¢æˆ·ç«¯ä¼šæ˜¾ç¤ºå¦‚ä¸‹æ¶ˆæ¯
1) "message"
2) "redisChat"
3) "Redis is a great caching technique"
1) "message"
2) "redisChat"
3) "Learn redis by w3cschool.cc"
```

Redis å‘å¸ƒè®¢é˜…å¸¸ç”¨å‘½ä»¤ : 

| åºå· | å‘½ä»¤åŠæè¿°                                                   |
| ---- | ------------------------------------------------------------ |
| 1    | `PSUBSCRIBE pattern [pattern ...]` , è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“ |
| 2    | `PUBSUB subcommand [argument [argument ...]]` , æŸ¥çœ‹è®¢é˜…ä¸å‘å¸ƒç³»ç»ŸçŠ¶æ€ |
| 3    | `PUBLISH channel message` , å°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“           |
| 4    | `PUNSUBSCRIBE [pattern [pattern ...]]` , é€€è®¢æ‰€æœ‰ç»™å®šæ¨¡å¼çš„é¢‘é“ |
| 5    | `SUBSCRIBE channel [channel ...]` , è®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯ |
| 6    | `UNSUBSCRIBE [channel [channel ...]]` , æŒ‡é€€è®¢ç»™å®šçš„é¢‘é“     |
